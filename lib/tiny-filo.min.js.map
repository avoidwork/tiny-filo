{"version":3,"sources":["tiny-filo.js"],"names":["global","factory","max","ttl","FILO","constructor","first","items","Map","last","size","has","key","clear","delete","item","get","prev","next","evict","result","expiry","Date","getTime","value","keys","Array","from","set","exports","define","amd","filo","module","window"],"mappings":"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","file":"unknown","sourcesContent":["/**\r\n * Tiny FILO cache for Client or Server\r\n *\r\n * @author Jason Mulligan <jason.mulligan@avoidwork.com>\r\n * @copyright 2019\r\n * @license BSD-3-Clause\r\n * @version 1.1.0\r\n */\r\n\r\n\r\n(function (global) {\r\n\tclass FILO {\r\n\t\tconstructor (max = 0, ttl = 0) {\r\n\t\t\tthis.first = null;\r\n\t\t\tthis.items = new Map();\r\n\t\t\tthis.last = null;\r\n\t\t\tthis.max = max;\r\n\t\t\tthis.size = 0;\r\n\t\t\tthis.ttl = ttl;\r\n\t\t}\r\n\r\n\t\thas (key) {\r\n\t\t\treturn this.items.has(key);\r\n\t\t}\r\n\r\n\t\tclear () {\r\n\t\t\tthis.first = null;\r\n\t\t\tthis.items.clear();\r\n\t\t\tthis.last = null;\r\n\t\t\tthis.size = 0;\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tdelete (key) {\r\n\t\t\tif (this.has(key)) {\r\n\t\t\t\tconst item = this.items.get(key);\r\n\r\n\t\t\t\tthis.items.delete(key);\r\n\t\t\t\tthis.size--;\r\n\r\n\t\t\t\tif (item.prev !== null) {\r\n\t\t\t\t\titem.prev.next = item.next;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (item.next !== null) {\r\n\t\t\t\t\titem.next.prev = item.prev;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this.first === item) {\r\n\t\t\t\t\tthis.first = item.next;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this.last === item) {\r\n\t\t\t\t\tthis.last = item.prev;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tevict () {\r\n\t\t\tconst item = this.last;\r\n\r\n\t\t\tthis.items.delete(item.key);\r\n\t\t\tthis.last = item.prev;\r\n\t\t\tthis.last.next = null;\r\n\t\t\tthis.size--;\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tget (key) {\r\n\t\t\tlet result;\r\n\r\n\t\t\tif (this.has(key)) {\r\n\t\t\t\tconst item = this.items.get(key);\r\n\r\n\t\t\t\tif (this.ttl > 0 && item.expiry <= new Date().getTime()) {\r\n\t\t\t\t\tthis.delete(key);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresult = item.value;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\tkeys () {\r\n\t\t\treturn Array.from(this.items.keys());\r\n\t\t}\r\n\r\n\t\tset (key, value) {\r\n\t\t\tif (this.has(key)) {\r\n\t\t\t\tthis.items.set(key, value);\r\n\t\t\t} else {\r\n\t\t\t\tif (this.max > 0 && this.size === this.max) {\r\n\t\t\t\t\tthis.evict();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst item = {\r\n\t\t\t\t\texpiry: this.ttl > 0 ? new Date().getTime() + this.ttl : this.ttl,\r\n\t\t\t\t\tkey,\r\n\t\t\t\t\tprev: this.last,\r\n\t\t\t\t\tnext: null,\r\n\t\t\t\t\tvalue\r\n\t\t\t\t};\r\n\r\n\t\t\t\tthis.items.set(key, item);\r\n\r\n\t\t\t\tif (++this.size === 1) {\r\n\t\t\t\t\tthis.first = item;\r\n\t\t\t\t\tthis.last = item;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.last.next = item;\r\n\t\t\t\t\tthis.last = item;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction factory (max = 1000, ttl = 0) {\r\n\t\treturn new FILO(max, ttl);\r\n\t}\r\n\r\n\t// Node, AMD & window supported\r\n\tif (typeof exports !== \"undefined\") {\r\n\t\tmodule.exports = factory;\r\n\t} else if (typeof define === \"function\" && define.amd !== void 0) {\r\n\t\tdefine(() => factory);\r\n\t} else {\r\n\t\tglobal.filo = factory;\r\n\t}\r\n}(typeof window !== \"undefined\" ? window : global));\r\n"]}